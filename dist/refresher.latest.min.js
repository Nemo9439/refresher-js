"use strict";class Refresher{static SECOND_IN_MS=1e3;static MINUTE_IN_MS=60*Refresher.SECOND_IN_MS;static DOM_ELEMENT_ID="refresher-js-toast";static SCRIPT_TAG_ID="refresher-js-script";static OPEN_TOAST_EVENT_NAME="refresher-js-open-toast";static ANGULAR_AND_REACT_MAIN_SCRIPT_PREFIX="main.";static ANGULAR_LAZY_LOADING_SCRIPT_PREFIX="runtime.";static VUE_V3_MAIN_SCRIPT_PREFIX="index.";static VUE_V2_MAIN_SCRIPT_PREFIX="app.";static DEFAULTS={PRIMARY_COLOR:"#004dff",TITLE_TEXT:"New version is available",SUBTITLE_TEXT:"Please refresh the page",REFRESH_BUTTON_TEXT:"Refresh",POLLING_INTERVAL_IN_MINUTES:120};static configuration={pollingIntervalInMinutes:void 0,titleText:void 0,subTitleText:void 0,primaryColor:void 0,refreshButtonText:void 0,disableToast:void 0,customFunctionName:void 0};static isUserActive=!1;static refresh(){location.reload()}static closeToast=()=>{const e=Refresher.getToastElement();e.classList.remove("opened"),setTimeout(()=>{e.remove()},Refresher.SECOND_IN_MS),Refresher.openToastLater()};static createToastElement=()=>{const e=document.createElement("div");e.id=Refresher.DOM_ELEMENT_ID;var t=`
                          <svg class="close-btn" viewPort="0 0 12 12" version="1.1"
                                              xmlns="http://www.w3.org/2000/svg" onclick="Refresher.closeToast()">
                                              <line x1="1" y1="11"
                                                    x2="11" y2="1"
                                                    stroke="black"
                                                    stroke-width="2"/>
                                              <line x1="1" y1="1"
                                                    x2="11" y2="11"
                                                    stroke="black"
                                                    stroke-width="2"/>
                            </svg>
                        <h2>${Refresher.configuration.titleText}</h2>
                        <p>${Refresher.configuration.subTitleText}</p>
                        <div class="buttons">
                          <button class="refresh" onclick="Refresher.refresh()">${Refresher.configuration.refreshButtonText}</button>

                `;return e.innerHTML=t,document.body.appendChild(e),Refresher.appendCustomCss(e),e};static appendCustomCss=e=>{const t=document.createElement("style");e.appendChild(t),t.innerHTML=`
  #${Refresher.DOM_ELEMENT_ID} {
    position: fixed;
    display: block;
    z-index: 101;
    min-width: 150px;
    bottom: 0;
    left: 20px;
    padding: 20px;
    border-radius: 5px;
    background: #ffffffd1;
    box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
    transition: 0.3s transform;
    border: 1px solid #efefef;
    border-left: 5px solid ${Refresher.configuration.primaryColor};
    transform: translate(0, 100%);
    backdrop-filter: blur(10px);
    font-weight: lighter;
  }

  #${Refresher.DOM_ELEMENT_ID}.opened {
    transform: translate(0, -15%);
  }

  #${Refresher.DOM_ELEMENT_ID} .close-btn {
    position: absolute;
    right: 20px;
    top: 20px;
    width: 15px;
    height: 15px;
    cursor: pointer;
    opacity: 0.6;
    transition: 0.3s;
    z-index: 999;
  }

  #${Refresher.DOM_ELEMENT_ID} .close-btn:hover {
    opacity: 1;
  }

  #${Refresher.DOM_ELEMENT_ID} .buttons {
    display: flex;
    justify-content: flex-end;
    margin-top: 20px;
  }

  #${Refresher.DOM_ELEMENT_ID} button {
    border-width: 0;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    outline: none;
    transition: filter 0.3s;
  }

  #${Refresher.DOM_ELEMENT_ID} button.refresh {
    color: #fff;
    background-color: ${Refresher.configuration.primaryColor};
    filter: saturate(0.8);
  }

  #${Refresher.DOM_ELEMENT_ID} button.refresh:hover {
    filter: saturate(1)
  }

  #${Refresher.DOM_ELEMENT_ID} h2 {
    font-weight: lighter;
    margin: 0;
    padding-right: 40px;
  }

  #${Refresher.DOM_ELEMENT_ID} p {
        margin: 0;
        margin-top: 10px;
        opacity: 0.8;
  }

  `};static openToastLater=()=>{setTimeout(()=>{Refresher.openToast()},Refresher.configuration.pollingIntervalInMinutes*Refresher.MINUTE_IN_MS)};static openToast=()=>{if(Refresher.dispatchOpenToastEvent(),!Refresher.getToastElement()&&!Refresher.configuration.disableToast){const e=Refresher.createToastElement();setTimeout(()=>{e.classList.add("opened")},Refresher.SECOND_IN_MS)}};static getToastElement=()=>document.getElementById(Refresher.DOM_ELEMENT_ID);static dispatchOpenToastEvent=()=>{document.dispatchEvent(new Event(Refresher.OPEN_TOAST_EVENT_NAME))};static getMainScript=e=>{const t=[...e.getElementsByTagName("script")];var r,e=t.filter(e=>e?.src?.includes(Refresher.ANGULAR_AND_REACT_MAIN_SCRIPT_PREFIX))?.[0];return e?(r=t.filter(e=>e?.src?.includes(Refresher.ANGULAR_LAZY_LOADING_SCRIPT_PREFIX))?.[0]?.src??"",e?.src+r):(t.filter(e=>e?.src?.includes(Refresher.VUE_V2_MAIN_SCRIPT_PREFIX)||e?.src?.includes(Refresher.VUE_V3_MAIN_SCRIPT_PREFIX))?.[0])?.src};static getRefresherScriptTag=()=>document.getElementById(Refresher.SCRIPT_TAG_ID);static handleCustomFunction=async()=>{await window[customFunctionName]()&&(Refresher.openToast(),clearInterval(intervalId))};static subscribeToActivityEvents=()=>{document.onvisibilitychange=()=>{"visible"===document.visibilityState&&(Refresher.isUserActive=!0)},onclick=()=>{Refresher.isUserActive=!0}};static init(){const e=new XMLHttpRequest,t=(e.onload=e=>{e=(new DOMParser).parseFromString(e.target.response,"text/html"),e=Refresher.getMainScript(e);i!==e&&(Refresher.openToast(),clearInterval(n),i=e)},Refresher.getRefresherScriptTag());var r=Refresher["DEFAULTS"];Refresher.configuration.pollingIntervalInMinutes=Number(t.getAttribute("data-polling-interval-in-minutes"))??r.POLLING_INTERVAL_IN_MINUTES,Refresher.configuration.titleText=t.getAttribute("data-title-text")??r.TITLE_TEXT,Refresher.configuration.subTitleText=t.getAttribute("data-subtitle-text")??r.SUBTITLE_TEXT,Refresher.configuration.primaryColor=t.getAttribute("data-primary-color")??r.PRIMARY_COLOR,Refresher.configuration.refreshButtonText=t.getAttribute("data-refresh-button-text")??r.REFRESH_BUTTON_TEXT,Refresher.configuration.disableToast="true"===t.getAttribute("data-disable-toast"),Refresher.configuration.customFunctionName=t.getAttribute("data-custom-function-name");const s=window.location.href;let i=Refresher.getMainScript(window.document);Refresher.subscribeToActivityEvents();const n=setInterval(async()=>{if(!Refresher.getToastElement()&&Refresher.isUserActive){if(Refresher.isUserActive=!1,Refresher.configuration.customFunctionName)return Refresher.handleCustomFunction();e.open("GET",s),e.send()}},Refresher.configuration.pollingIntervalInMinutes*Refresher.MINUTE_IN_MS)}}Refresher.init();
